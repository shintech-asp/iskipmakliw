@model List<iskipmakliw.Models.Payments>
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    var name = HttpContextAccessor.HttpContext.Session.GetString("Username");
    var email = HttpContextAccessor.HttpContext.Session.GetString("Email");
    var contact = HttpContextAccessor.HttpContext.Session.GetString("ContactNumber");

    var totalAmount = Model.Sum(p => p.Amount ?? 0);
    var paymentIds = string.Join(",", Model.Select(p => p.Id));
    var productNames = string.Join(", ", Model.Select(p => p.PaymentDetails));
}

<form method="post" asp-controller="Payments" asp-action="PayNow">
    <div class="row invoice layout-top-spacing layout-spacing">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">

            <div class="doc-container">

                <div class="row">

                    <div class="col-xl-9">

                        <div class="invoice-container">
                            <div class="invoice-inbox">

                                <div id="ct" class="">

                                    <div class="invoice-00001">
                                        <div class="content-section">

                                            <div class="inv--head-section inv--detail-section">

                                                <div class="row">

                                                    <div class="col-sm-6 col-12 mr-auto">
                                                        <div class="d-flex">
                                                            <img class="company-logo w-25" src="~/src/assets/img/OakMartLogo.png" alt="company">
                                                            <h3 class="in-heading align-self-center">OakMart</h3>
                                                        </div>
                                                        <p class="inv-street-addr mt-3">@Model.FirstOrDefault().Users.UserDetails.Plans.PlanName</p>
                                                        <p class="inv-email-address">@Model.FirstOrDefault().Users.Email</p>
                                                        <p class="inv-email-address">@Model.FirstOrDefault().Users.ContactNumber</p>
                                                    </div>

                                                    <div class="col-sm-6 text-sm-end">
                                                        <p class="inv-list-number mt-sm-3 pb-sm-2 mt-4"><span class="inv-title">Invoice : </span> <span class="inv-number">#@Model.FirstOrDefault().Id</span></p>
                                                        <p class="inv-created-date mt-sm-5 mt-3"><span class="inv-title">Invoice Date : </span> <span class="inv-date">@DateTime.Now</span></p>
                                                        <p class="inv-due-date"><span class="inv-title">Due Date : </span> <span class="inv-date">@DateTime.Now</span></p>
                                                    </div>
                                                </div>

                                            </div>

                                            <div class="inv--detail-section inv--customer-detail-section">

                                                <div class="row">

                                                    <div class="col-xl-8 col-lg-7 col-md-6 col-sm-4 align-self-center">
                                                        <p class="inv-to">Invoice To</p>
                                                    </div>

                                                    <div class="col-xl-4 col-lg-5 col-md-6 col-sm-8 align-self-center order-sm-0 order-1 text-sm-end mt-sm-0 mt-5">
                                                        <h6 class=" inv-title">Invoice From</h6>
                                                    </div>

                                                    <div class="col-xl-8 col-lg-7 col-md-6 col-sm-4">
                                                        <p class="inv-customer-name">@Model.FirstOrDefault().Users.Username</p>
                                                        <p class="inv-email-address">@Model.FirstOrDefault().Users.Email</p>
                                                        <p class="inv-email-address">@Model.FirstOrDefault().Users.ContactNumber</p>
                                                    </div>

                                                    <div class="col-xl-4 col-lg-5 col-md-6 col-sm-8 col-12 order-sm-0 order-1 text-sm-end">
                                                        <p class="inv-customer-name">OakMart</p>
                                                    </div>

                                                </div>

                                            </div>

                                            @{
                                                var subs = Model.FirstOrDefault().Users.UserDetails.Subscription;
                                                int discount;
                                                double? amount;
                                                if (subs.ToLower() == "yearly")
                                                {
                                                    discount = 20;
                                                    amount = Model.FirstOrDefault().Users.UserDetails.Plans.Price * 12;
                                                }
                                                else
                                                {
                                                    discount = 0;
                                                    amount = Model.FirstOrDefault().Amount;
                                                }
                                                var discountPrice = amount * (discount / 100);
                                            }
                                            <div class="inv--product-table-section">
                                                <div class="table-responsive">
                                                    <table class="table">
                                                        <thead class="">
                                                            <tr>
                                                                <th scope="col">S.No</th>
                                                                <th scope="col">Items</th>
                                                                <th class="text-end" scope="col">Qty</th>
                                                                <th class="text-end" scope="col">Amount</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach(var data in Model)
                                                            {
                                                                int number = 1;
                                                                <tr>
                                                                    <td>@number</td>
                                                                    <td>@data.PaymentDetails</td>
                                                                    <td class="text-end">1</td>
                                                                    <td class="text-end">@data.Amount</td>
                                                                </tr>
                                                                number++;
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>

                                            <div class="inv--total-amounts">

                                                <div class="row mt-4">
                                                    <div class="col-sm-5 col-12 order-sm-0 order-1">
                                                    </div>
                                                    <div class="col-sm-7 col-12 order-sm-1 order-0">
                                                        <div class="text-sm-end">
                                                            <div class="row">
                                                                <div class="col-sm-8 col-7">
                                                                    <p class="">Sub Total :</p>
                                                                </div>
                                                                <div class="col-sm-4 col-5">
                                                                    <p class="">@amount</p>
                                                                </div>
                                                                <div class="col-sm-8 col-7">
                                                                    <p class=" discount-rate">Shipping :</p>
                                                                </div>
                                                                <div class="col-sm-4 col-5">
                                                                    <p class="">$0</p>
                                                                </div>
                                                                <div class="col-sm-8 col-7">
                                                                    <p class=" discount-rate">Discount %@discount :</p>
                                                                </div>
                                                                <div class="col-sm-4 col-5">
                                                                    <p class="">@discountPrice</p>
                                                                </div>
                                                                <div class="col-sm-8 col-7 grand-total-title mt-3">
                                                                    <h4 class="">Grand Total :</h4>
                                                                </div>
                                                                <div class="col-sm-4 col-5 grand-total-amount mt-3">
                                                                    <h4 class="">@Model.FirstOrDefault().Amount</h4>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>

                                            <div class="inv--note">

                                                <div class="row mt-4">
                                                    <div class="col-sm-12 col-12 order-sm-0 order-1">
                                                        <p>Note: Thank you for doing Business with us.</p>
                                                    </div>
                                                </div>

                                            </div>

                                        </div>
                                    </div>

                                </div>


                            </div>

                        </div>

                    </div>

                    <div class="col-xl-3">

                        <div class="invoice-actions-btn">

                            <div class="invoice-action-btn">

                                <div class="row">
                                    <div class="col-xl-12 col-md-3 col-sm-6">
                                        <a href="javascript:void(0);" class="btn btn-primary btn-send _effect--ripple waves-effect waves-light">Send Invoice</a>
                                    </div>
                                    <div class="col-xl-12 col-md-3 col-sm-6">
                                        <a href="javascript:void(0);" class="btn btn-secondary btn-print action-print _effect--ripple waves-effect waves-light">Print</a>
                                    </div>
                                    <div class="col-xl-12 col-md-3 col-sm-6">
                                        <a href="javascript:void(0);" class="btn btn-success btn-download _effect--ripple waves-effect waves-light">Download</a>
                                    </div>
                                    <div class="col-xl-12 col-md-3 col-sm-6">
                                        <input type="hidden" name="totalAmount" value="@totalAmount" />
                                        <input type="hidden" name="productNames" value="@productNames" />
                                        <input type="hidden" name="paymentIds" value="@paymentIds" />
                                        <input type="hidden" name="UserName" value="@name" />
                                        <input type="hidden" name="Email" value="@email" />
                                        <input type="hidden" name="Contact" value="@contact" />
                                        <button type="submit" class="btn btn-dark btn-edit _effect--ripple waves-effect waves-light w-100">Pay Now</button>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
